{% extends 'base.html.twig' %}

{% block title %}Hello LoginController!{% endblock %}

{% block body %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
</style>

<div class="example-wrapper">
    <h2>Login form</h2>
    <div>
        <label>Username: </label>
        <input type="text" name="username" id="username"><br>
        <label>Password: </label>
        <input type="password" name="password" id="password"><br>
        <p id="user-data" style="display:none;">{{users}}<p>
        <p style="color:red;" id="errors"></p>
        <button id="connect">Connexion</button>
    </div>
</div>

<script>
    const userData = JSON.parse(document.getElementById('user-data').innerHTML);
    const connectBtn = document.getElementById('connect');
    const errors = document.getElementById('errors');
    console.log(typeof userData);

    function connect() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;

        if(username !== '' && password !== "") {
            const result = userData.find((user) => user.Name === username);
            if(result.Password === password) {
                localStorage.setItem("myUser", username);
                errors.innerHTML = "";
                window.location.href = "/";
            }else {
                errors.innerHTML = "Nom d'utilisateur ou MDP inccorect";
            }
        }else {
            errors.innerHTML = "Nom d'utilisateur ou MDP inccorect";
        }

    }

    connectBtn.addEventListener('click', () => {
        connect();
    })
</script>
{% endblock %}
